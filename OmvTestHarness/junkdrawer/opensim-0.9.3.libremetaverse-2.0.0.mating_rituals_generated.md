# OpenSim Client/Server Mating Rituals (Naturalist Edition)

*This document captures the raw "DX story" of the connection sequence between an OpenSim Server and a LibreMetaverse Client, as observed by a neutral 3rd party observer. It utilizes "benign logging probes" inserted at strategic architectural junctions to record the actual signals exchanged.*

## Prologue: The Environment
- **Server**: OpenSim (Instrumented)
- **Client**: LibreMetaverse Test Harness (Instrumented)
- **Protocol**: HTTP (XML-RPC), UDP, HTTP (Caps)

---

## Part I: The Login Sequence (HTTP/XML-RPC)
1.  **[CLIENT] [LOGIN] START**: The client begins the login process for `Test User`.
1.  **[SERVER] [LOGIN] RECV XML-RPC login_to_simulator**: The server receives the XML-RPC request containing the user's name and viewer details.
1.  **[SERVER] [LOGIN] AUTH SUCCESS**: The server authenticates the user credentials against the User Account Service.
1.  **[SERVER] [LOGIN] CIRCUIT PROVISION**: The server provisions a `CircuitCode` on the destination region.
1.  **[SERVER] [LOGIN] SEND XML-RPC Response**: The server responds with `Success`, the `CircuitCode`, the `SessionID`, and the Region's IP/Port.
1.  **[CLIENT] [LOGIN] PROGRESS ConnectingToSim**: The client acknowledges the successful login and prepares to connect to the simulator.

## Part II: The Handshake (UDP)
1.  **[SERVER] [UDP] RECV UseCircuitCode**: The server receives the first critical packet. It contains the `CircuitCode` (CircuitCode: 473293782, Session: 19d83417-3dc6-4dd7-b6df-d55afff6d84d) and `SessionID`. The server validates this against the provisioned circuit from Part I.
1.  **[SERVER] [UDP] SEND RegionHandshake**: Upon validation, the server sends the `RegionHandshake` packet, detailing region flags and parameters.

## Part IV: World Materialization (UDP Stream)
1.  **[SERVER] [UDP] SEND AgentMovementComplete**: The server places the avatar in the world (Position: `Pos: <128, 128, 26.03416>, Look: <0.99, 0.042, 0>`) and informs the client.
1.  **[CLIENT] [UDP] CONNECTED**: The client opens a UDP socket to the server's IP.
1.  **[CLIENT] [UDP] RECV ObjectUpdate**: The client receives packets describing objects in the scene.
1.  **[CLIENT] [UDP] RECV LayerData**: The client receives a stream of terrain patches (LayerData packets) to build the ground geometry.
---

*Generated by MatingRitualLogger instrumentation.*