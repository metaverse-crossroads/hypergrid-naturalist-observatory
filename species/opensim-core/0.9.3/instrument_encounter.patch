
--- /dev/null	2025-11-07 00:27:45.917313976 +0000
+++ OpenSim/Framework/EncounterLogger.cs	2025-12-20 01:34:23.842265310 +0000
@@ -0,0 +1,33 @@
+using System;
+using System.IO;
+using System.Text;
+using log4net;
+using System.Reflection;
+
+namespace OpenSim.Framework
+{
+    public static class EncounterLogger
+    {
+        private static readonly ILog m_log = LogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType);
+        private static string LogPath = "encounter.log";
+
+        public static void Log(string side, string component, string signal, string payload = "")
+        {
+            string message = $"[ENCOUNTER] [{side}] [{component}] {signal}";
+            if (!string.IsNullOrEmpty(payload))
+            {
+                message += $" | {payload}";
+            }
+
+            // Log to console/standard log for visibility
+            m_log.Info(message);
+
+            // Also append to a specific file for the report
+            try
+            {
+                File.AppendAllText(LogPath, $"{DateTime.Now:yyyy-MM-dd HH:mm:ss.fff} {message}{Environment.NewLine}");
+            }
+            catch (Exception) { /* Best effort */ }
+        }
+    }
+}
--- a/OpenSim/Services/LLLoginService/LLLoginService.cs
+++ b/OpenSim/Services/LLLoginService/LLLoginService.cs
@@ -332,6 +332,7 @@
         public LoginResponse Login(string firstName, string lastName, string passwd, string startLocation, UUID scopeID,
             string clientVersion, string channel, string mac, string id0, IPEndPoint clientIP)
         {
+            EncounterLogger.Log("SERVER", "LOGIN", "RECV XML-RPC login_to_simulator", $"User: {firstName} {lastName}, Viewer: {clientVersion}, Channel: {channel}, IP: {clientIP}");

             bool success;
             UUID session = UUID.Random();
@@ -458,11 +459,13 @@
                 UUID secureSession = UUID.Zero;
                 if (string.IsNullOrWhiteSpace(token) || !UUID.TryParse(token, out secureSession))
                 {
+                    EncounterLogger.Log("SERVER", "LOGIN", "AUTH FAIL", $"User: {firstName} {lastName}");
                     m_log.InfoFormat(
                         "[LLOGIN SERVICE]: Login failed for {0} {1}, reason: authentication failed",
                         firstName, lastName);
                     return LLFailedLoginResponse.UserProblem;
                 }
+                EncounterLogger.Log("SERVER", "LOGIN", "AUTH SUCCESS", $"User: {firstName} {lastName}");

                 string PrincipalIDstr = account.PrincipalID.ToString();
                 GridUserInfo guinfo = m_GridUserService.GetGridUserInfo(PrincipalIDstr);
@@ -601,11 +604,13 @@
                 destination = dest;
                 if (aCircuit == null)
                 {
+                    EncounterLogger.Log("SERVER", "LOGIN", "CIRCUIT FAIL", $"Reason: {reason}");
                     m_PresenceService.LogoutAgent(session);
                     m_log.InfoFormat("[LLOGIN SERVICE]: Login failed for {0} {1}, reason: {2}", firstName, lastName, reason);
                     return new LLFailedLoginResponse("key", reason, "false");

                 }
+                EncounterLogger.Log("SERVER", "LOGIN", "CIRCUIT PROVISION", $"Circuit: {aCircuit.circuitcode}, Region: {destination.RegionName}");

                 // only now we can assume a login
                 guinfo = m_GridUserService.LoggedIn(PrincipalIDstr);
@@ -635,6 +640,7 @@

                     m_log.DebugFormat("[LLOGIN SERVICE]: All clear. Sending login response to {0} {1}", firstName, lastName);

+                    EncounterLogger.Log("SERVER", "LOGIN", "SEND XML-RPC Response", "Success");
                     return response;
                }
             catch (Exception e)
--- a/OpenSim/Region/ClientStack/Linden/UDP/LLUDPServer.cs
+++ b/OpenSim/Region/ClientStack/Linden/UDP/LLUDPServer.cs
@@ -1562,6 +1562,7 @@

                 if (IsClientAuthorized(uccp, out AuthenticateResponse sessionInfo))
                 {
+                    EncounterLogger.Log("SERVER", "UDP", "RECV UseCircuitCode", $"CircuitCode: {uccp.CircuitCode.Code}, Session: {uccp.CircuitCode.SessionID}");

                     AgentCircuitData aCircuit = m_circuitManager.GetAgentCircuitData(uccp.CircuitCode.Code);
                     if(!string.IsNullOrEmpty(aCircuit.IPAddress))
@@ -1631,6 +1632,7 @@
                 }
                 else
                 {
+                    EncounterLogger.Log("SERVER", "UDP", "REJECT UseCircuitCode", $"Unauthorized Circuit: {uccp.CircuitCode.Code}");
                     // Don't create clients for unauthorized requesters.
                     m_log.WarnFormat(
                         "[LLUDPSERVER]: Ignoring connection request for {0} to {1} with unknown circuit code {2} from IP {3}",
@@ -1755,6 +1757,7 @@
         /// <param name='timeoutTicks'></param>
         protected void DeactivateClientDueToTimeout(LLClientView client, int timeoutTicks)
         {
+            EncounterLogger.Log("SERVER", "UDP", "TIMEOUT", $"Agent: {client.Name}, LastActive: {timeoutTicks}ms ago");

             ClientLogoutsDueToNoReceives++;
             if (client.SceneAgent != null)
--- a/OpenSim/Region/ClientStack/Linden/UDP/LLClientView.cs
+++ b/OpenSim/Region/ClientStack/Linden/UDP/LLClientView.cs
@@ -877,6 +877,7 @@

         public void SendRegionHandshake()
         {
+            EncounterLogger.Log("SERVER", "UDP", "SEND RegionHandshake", $"Region: {m_scene.RegionInfo.RegionName}");

             GetViewerCaps(); // make sure this is up to date

@@ -1000,6 +1001,7 @@

         public unsafe void MoveAgentIntoRegion(RegionInfo regInfo, Vector3 pos, Vector3 look)
         {
+            EncounterLogger.Log("SERVER", "UDP", "SEND AgentMovementComplete", $"Pos: {pos}, Look: {look}");

             // reset agent update args
             m_thisAgentUpdateArgs.CameraAtAxis.X = float.MinValue;
@@ -1567,6 +1569,7 @@
         /// <param name="map">heightmap</param>
         public virtual void SendLayerData()
         {
+            EncounterLogger.Log("SERVER", "UDP", "SEND LayerData", "Terrain Patches");
             Util.FireAndForget(DoSendLayerData, null, "LLClientView.DoSendLayerData");
         }
