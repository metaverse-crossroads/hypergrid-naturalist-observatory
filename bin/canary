#!/bin/bash
# bin/canary
# ==========
# THE ALADDIN RUG PROTOCOL
#
# IF YOU ARE READING THIS OR EXECUTING THIS SCRIPT:
# -------------------------------------------------
# It is highly likely that the environment has been RESET ("Rug Pulled")
# from under your feet.
#
# 1. DO NOT PANIC.
# 2. DO NOT FLAMEOUT. (Do not run 100 random commands trying to fix it).
# 3. Work in progress (uncommitted files, staged files) IS LOST.
# 4. Committed work (in the repo) IS SAFE (if this file exists).
#
# YOUR MISSION NOW:
# -----------------
# 1. Consult AGENTS.md immediately.
# 2. Review the Chat History to recall where you were.
# 3. Re-apply necessary changes manually.
# 4. Re-incubate required specimens.
#
# USAGE:
# ------
# This script is meant to be SOURCED by observatory_env.bash, not executed.
# But if you are executing it, you have found the Canary. It is dead.
# The environment is fresh.
#
# To re-activate the canary wrapper (for the NEXT rug pull):
#   source instruments/substrate/observatory_env.bash
#
# -------------------------------------------------------------------------

# If script is sourced, define the function.
# If script is executed, print the warning above.

(return 0 2>/dev/null) && SOURCED=1 || SOURCED=0

if [ "$SOURCED" -eq 1 ]; then
    function canary() {
        "$@"
    }
    export -f canary
else
    echo "⚠️  [CANARY] ENVIRONMENT RESET DETECTED ⚠️"
    echo "   See bin/canary source code for instructions."
    echo "   Do not panic. Proceed to AGENTS.md."
    exit 1
fi
